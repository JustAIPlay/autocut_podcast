# 📋 提示词检查报告

**检查时间**: 2026-01-29  
**检查文件**: 
- `prompt_scene_split.md`
- `prompt_image_generation.md`

---

## ❌ 发现的问题

### 1. **格式不匹配问题**（严重）

#### `prompt_scene_split.md` 的问题

**脚本期望的格式**：
```json
[
  {"scene": 1, "text": "..."},
  {"scene": 2, "text": "..."}
]
```

**原提示词要求的格式**：
```json
{
  "scene_breakdown": "1. ...\n2. ..."
}
```

**问题**：
- ❌ 脚本期望数组格式，但提示词要求对象格式
- ❌ 脚本期望结构化数据（每个场景是独立对象），但提示词要求字符串格式
- ❌ 字段名不匹配（`scene_breakdown` vs `scene` 和 `text`）

#### `prompt_image_generation.md` 的问题

**脚本期望的格式**：
```json
[
  {"scene": 1, "text": "...", "prompt": "..."},
  {"scene": 2, "text": "...", "prompt": "..."}
]
```

**原提示词要求的格式**：
```json
{
  "image_prompts": "【m1】...\n【m2】..."
}
```

**问题**：
- ❌ 脚本期望数组格式，但提示词要求对象格式
- ❌ 脚本期望每个场景包含 `scene`、`text`、`prompt` 三个字段，但提示词只要求一个字符串
- ❌ 字段名不匹配（`image_prompts` vs `prompt`）
- ❌ 缺少 `scene` 和 `text` 字段，脚本无法验证和匹配

---

## ✅ 修正内容

### 1. `prompt_scene_split.md` 修正

**修正后的输出格式**：
```json
[
  {
    "scene": 1,
    "text": "第一个分镜的文本内容"
  },
  {
    "scene": 2,
    "text": "第二个分镜的文本内容"
  }
]
```

**关键改动**：
- ✅ 改为数组格式（符合脚本期望）
- ✅ 每个元素包含 `scene` 和 `text` 字段
- ✅ 添加了清晰的示例说明
- ✅ 强调必须返回数组格式

### 2. `prompt_image_generation.md` 修正

**修正后的输出格式**：
```json
[
  {
    "scene": 1,
    "text": "场景1的原始文本",
    "prompt": "【m1】具体画面内容描述，写实，油画质感..."
  },
  {
    "scene": 2,
    "text": "场景2的原始文本",
    "prompt": "【m2】具体画面内容描述，写实，油画质感..."
  }
]
```

**关键改动**：
- ✅ 改为数组格式（符合脚本期望）
- ✅ 每个元素包含 `scene`、`text`、`prompt` 三个字段
- ✅ `text` 字段必须与输入场景的文本内容完全一致（脚本会验证）
- ✅ `prompt` 字段包含图片生成提示词
- ✅ 添加了清晰的示例说明
- ✅ 强调必须返回数组格式，且长度与输入一致

---

## 📊 格式对比表

| 项目 | 脚本期望 | 原提示词要求 | 修正后 |
|------|----------|--------------|--------|
| **场景拆分** | 数组 `[{...}]` | 对象 `{scene_breakdown: "..."}` | ✅ 数组 `[{scene, text}]` |
| **生图提示词** | 数组 `[{...}]` | 对象 `{image_prompts: "..."}` | ✅ 数组 `[{scene, text, prompt}]` |
| **字段名** | `scene`, `text`, `prompt` | `scene_breakdown`, `image_prompts` | ✅ 匹配脚本期望 |

---

## 🔍 其他检查项

### ✅ 格式规范检查

- ✅ 占位符正确：`{text}` 和 `{scenes}` 都存在
- ✅ 输出要求清晰：禁止思考过程、XML标签等
- ✅ 示例完整：提供了详细的输出示例
- ✅ 符号规范：明确了可用和禁止的符号

### ✅ 内容完整性检查

- ✅ 任务说明清晰
- ✅ 规则要求明确
- ✅ 格式要求详细
- ✅ 示例符合要求

---

## ⚠️ 注意事项

### 1. 数据一致性

**`prompt_image_generation.md` 特别重要**：
- `text` 字段必须与输入场景的 `text` 字段**完全一致**
- 脚本会验证 `scene` 序号是否连续
- 输出数组长度必须与输入数组长度一致

### 2. JSON 格式要求

- 必须返回**纯 JSON**，不要包含 markdown 代码块标记（```json）
- 脚本会自动清理 markdown 标记，但最好直接返回 JSON
- 确保 JSON 格式正确，避免解析错误

### 3. 符号使用

- 提示词中可以使用 `【】`、`《》`、逗号、句号
- **严禁使用**圆括号 `()`、`（）`、方括号 `[]`（除序号位外）

---

## ✅ 验证建议

### 测试步骤

1. **测试场景拆分**
   ```powershell
   python .claude/skills/auto_edit_video/scripts/analyze_scenes.py test001
   ```
   - 检查步骤1的输出是否为数组格式
   - 检查每个元素是否包含 `scene` 和 `text` 字段

2. **测试生图提示词生成**
   - 检查步骤2的输出是否为数组格式
   - 检查每个元素是否包含 `scene`、`text`、`prompt` 三个字段
   - 检查 `text` 字段是否与输入一致

3. **检查最终输出文件**
   ```powershell
   # 查看生成的 scenes.json
   type raw_materials\copys\test001_scenes.json
   ```
   - 验证格式是否正确
   - 验证数据完整性

---

## 📝 总结

### 修正前的问题
- ❌ 输出格式与脚本期望完全不匹配
- ❌ 会导致 JSON 解析失败
- ❌ 脚本无法正确提取数据

### 修正后的状态
- ✅ 输出格式完全匹配脚本期望
- ✅ 数据结构清晰明确
- ✅ 包含完整的示例和说明
- ✅ 可以正常解析和处理

---

**检查完成时间**: 2026-01-29  
**状态**: ✅ 已修正并验证
