---
name: video:安装
description: 环境准备。安装依赖、验证环境。触发词：安装、环境准备、初始化
---

<!--
input: 无
output: 环境就绪
pos: 前置 skill，首次使用前运行

架构守护者：一旦我被修改，请同步更新：
1. ../README.md 的 Skill 清单
2. /CLAUDE.md 路由表
-->

# 安装

> 首次使用前的环境准备

## 快速使用

```
用户: 安装环境
用户: 初始化
用户: 环境准备
```

## 依赖清单

| 依赖 | 用途 | 是否必需 | 安装命令 |
|------|------|----------|----------|
| ffmpeg | 视频处理 | ✅ 必需 | `brew install ffmpeg` |
| openai-whisper | 字幕生成 | ✅ 必需 | `pip install openai-whisper` |
| requests | HTTP请求 | ✅ 必需 | `pip install requests` |
| yt-dlp | 平台视频下载 | ⚠️ 可选 | `pip install yt-dlp` |
| ComfyUI | AI生图 | ✅ 必需 | 手动配置 |

## 模型清单

### Whisper 模型（字幕生成用）

首次运行自动下载到 `~/.cache/whisper/`：

| 模型 | 大小 | 用途 |
|------|------|------|
| medium | 1.5GB | 默认，平衡速度与准确率 |
| large-v3 | 2.9GB | 高精度，较慢 |

### 总计

约 **1.5GB ~ 3GB** 模型文件（取决于选择的模型）

## 安装流程

```
1. 安装 Python 依赖
       ↓
2. 安装 FFmpeg
       ↓
3. 配置 ComfyUI（手动）
       ↓
4. 下载 Whisper 模型（首次运行自动）
       ↓
5. 验证环境
```

## 执行步骤

### 1. 安装 Python 依赖

```bash
pip install openai-whisper requests yt-dlp
```

### 2. 安装 FFmpeg

```bash
# macOS
brew install ffmpeg

# Ubuntu/Debian
sudo apt install ffmpeg

# Windows (使用 winget)
winget install ffmpeg

# 验证
ffmpeg -version
```

### 3. 配置 ComfyUI

ComfyUI 需要手动安装和配置：

```bash
# 克隆 ComfyUI
git clone https://github.com/comfyanonymous/ComfyUI.git
cd ComfyUI

# 安装依赖
pip install -r requirements.txt

# 启动服务
python main.py --listen 127.0.0.1 --port 8188
```

确保 ComfyUI 运行在 `http://127.0.0.1:8188`

### 4. 下载 Whisper 模型（首次运行自动）

```python
import whisper

# 选择模型: tiny, base, small, medium, large-v3
model = whisper.load_model("medium")
print("Whisper 模型下载完成")
```

### 5. 验证环境

```bash
# 检查 FFmpeg
ffmpeg -version

# 检查 Whisper
python -c "import whisper; print('Whisper OK')"

# 检查 requests
python -c "import requests; print('Requests OK')"

# 检查 yt-dlp（可选）
yt-dlp --version

# 检查 ComfyUI API
curl http://127.0.0.1:8188/system_stats
```

## 进度TodoList

```
- [ ] 安装 Python 依赖
- [ ] 安装 FFmpeg
- [ ] 配置 ComfyUI
- [ ] 下载 Whisper 模型
- [ ] 验证环境
```

## 常见问题

### Q1: FFmpeg 命令找不到

**解决**：确认已安装并添加到 PATH

```bash
# 检查 FFmpeg 路径
which ffmpeg    # macOS/Linux
where ffmpeg    # Windows
```

### Q2: Whisper 下载慢

**解决**：设置镜像或手动下载模型

### Q3: ComfyUI 连接失败

**解决**：
1. 确认 ComfyUI 正在运行
2. 检查端口 8188 是否被占用
3. 访问 http://127.0.0.1:8188 确认服务可用

### Q4: yt-dlp 下载视频失败

**解决**：
- 更新 yt-dlp: `pip install -U yt-dlp`
- 某些平台可能需要额外配置

### Q5: Python 版本问题

**解决**：需要 Python 3.8+

```bash
python --version
```

## ComfyUI 工作流配置

项目使用的工作流文件：`/workflow/wst_workflow.json`

确保 ComfyUI 中已安装：
- 主模型：`zImageTurboQuantized_fp8E4m3fn.safetensors`
- CLIP模型：`qwen_3_4b.safetensors`
- VAE：`ae.safetensors`
